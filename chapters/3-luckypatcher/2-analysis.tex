\section{Code Analysis} \label{section:luckypatcher-analysis}
The code analysis was done using LuckyPatcher in version 6.0.4 using the two tools descibed in subsection~\ref{subsection:forensics-tools-java}.
The reversed code was inspected using a text editor like Atom \cite{atom}.
\newline
Before analysing the code, a look is taken at the structure.
When loading the folder of the reengineered code into the editor a lot of different code folders can be spotted.
These code folders hold the packages of LuckyPatcher itself and used libraries.
The libraries can be divided in four categories.
The first category contains the Android Support Library v4 with many of it's modules, which LuckyPatcher includes as well as many other applications.
It is used for downward compability of Android related functions of LuckyPatcher itself.
The second category contains the code of LuckyPatcher. It is located in two places.
In the package com.chelpus utility functions, like "copy file" and "rename", are stored.
The "application" itself is com.android.vending.billing.InAppBillingService.LACK. It contains the activities and functions which are used for cracking applications.
The third category are support libraries required by LuckyPatcher to apply it's cracking mechanisms.
This includes libraries like axml \cite{axml} for serializing the AndroidManifest.xml from Android binary into a ASCII formatted xml file to make it readable and zip4j \cite{zip4j}, a Java library to handle ZIP files, to name a few.
The fourth and last category is an modified billing and license library, which can be applied in combination to use a proxy to redirect inapp billing and licensing calls, and a package containing the already cracked \gls{lvl} which will be explained in section~\ref{section:luckypatcher-patterns}.
In addition to these categories, the asset folder stores different predefinded custom patches which can be applied applications \cite{munteanLicensing}.
\newline
This is very hard since there is no folder structure sorting the classes in activities or models.
The patchActivity in the package com.android.vending.billing.InAppBillingService.LACK can be identified as launcher method when looking into the AndroidManifest.xml file.
The folder embracing the activity has a flat hierarchy and is not grouped into folders by activities or models.
In the launcherActivity the listAppsFragment is created which implements most of the app logic in over 13000 lines of code.
This makes it difficult to get a clear understanding of how exactly LuckyPatcher is patching the attacked application.
Another problem is the obfuscation of strings and methods which makes it impossible to get their purpose just from the name.
At some points it is even impossible for the decompiler tool to disassemble to Java code and thus it returns just the instruction dump.
